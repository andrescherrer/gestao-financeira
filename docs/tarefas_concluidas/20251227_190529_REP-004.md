# REP-004 - Criar use case para receitas vs despesas

**Data:** 2025-12-27  
**Status:** ✅ Concluída

## Resumo da Implementação

**Tarefa:** REP-004 - Criar use case para receitas vs despesas

### Implementação

Criado use case completo para geração de relatórios comparativos de receitas vs despesas, incluindo:
- Comparação geral de receitas e despesas
- Suporte a agrupamento por período (day, week, month, year)
- Filtros por período e moeda
- Cálculo de diferença e saldo

### Arquivos Criados

1. **`backend/internal/reporting/application/dtos/income_vs_expense_input.go`**
   - DTO de entrada com validações
   - Campos: user_id, start_date (opcional), end_date (opcional), currency (opcional), group_by (opcional)

2. **`backend/internal/reporting/application/dtos/income_vs_expense_output.go`**
   - DTO de saída com comparação de receitas vs despesas
   - Inclui: totais, diferença, contagens, breakdown por período (se group_by especificado)

3. **`backend/internal/reporting/application/usecases/income_vs_expense_usecase.go`**
   - Use case principal para comparação de receitas vs despesas
   - Calcula totais de receitas e despesas
   - Calcula diferença (receitas - despesas)
   - Suporta agrupamento por período (day, week, month, year)
   - Suporta filtros por período e moeda

4. **`backend/internal/reporting/application/usecases/income_vs_expense_usecase_test.go`**
   - Testes unitários completos
   - Testa cálculo correto de totais e diferença
   - Testa agrupamento por período
   - Testa validação de entrada
   - Cobertura de casos de erro

### Funcionalidades

- ✅ Comparação de receitas vs despesas
- ✅ Cálculo de totais (income, expense)
- ✅ Cálculo de diferença (income - expense)
- ✅ Cálculo de saldo
- ✅ Agrupamento opcional por período (day, week, month, year)
- ✅ Filtro opcional por período (start_date, end_date)
- ✅ Filtro opcional por moeda
- ✅ Contagem de transações por tipo
- ✅ Validação de entrada
- ✅ Testes unitários completos

### Agrupamento por Período

O relatório suporta agrupamento opcional por:
- **day**: Agrupa por dia (formato: YYYY-MM-DD)
- **week**: Agrupa por semana (início na segunda-feira)
- **month**: Agrupa por mês (formato: YYYY-MM)
- **year**: Agrupa por ano (formato: YYYY)

### Estrutura do Relatório

O relatório de receitas vs despesas retorna:
- Total de receitas (income)
- Total de despesas (expense)
- Saldo (balance = income - expense)
- Diferença (difference = income - expense)
- Contagem de transações (income_count, expense_count, total_count)
- Moeda utilizada
- Breakdown por período (se group_by especificado)

### Breakdown por Período

Cada entrada do breakdown contém:
- Period (identificador do período)
- TotalIncome (total de receitas no período)
- TotalExpense (total de despesas no período)
- Balance (saldo do período)
- IncomeCount (quantidade de receitas)
- ExpenseCount (quantidade de despesas)

### Testes

```bash
cd backend
go test ./internal/reporting/application/usecases/... -v -run TestIncomeVsExpenseUseCase
```

**Resultado:** ✅ Todos os testes passando

### Dependências

- ✅ REP-001: Use case para relatório mensal (estrutura base)

### Próximos Passos

- REP-005: Criar ReportHandler
- REP-006: Configurar rotas de reports

---

**Autor:** Sistema de Gestão Financeira  
**Data:** 2025-12-27


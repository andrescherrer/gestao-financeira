# REP-002 - Criar use case para relatório anual

**Data:** 2025-12-27  
**Status:** ✅ Concluída

## Resumo da Implementação

**Tarefa:** REP-002 - Criar use case para relatório anual

### Implementação

Criado use case completo para geração de relatórios anuais financeiros, incluindo:
- DTOs de entrada e saída
- Lógica de cálculo de receitas, despesas e saldo anual
- Breakdown mensal (12 meses)
- Filtragem por período e moeda

### Arquivos Criados

1. **`backend/internal/reporting/application/dtos/annual_report_input.go`**
   - DTO de entrada com validações
   - Campos: user_id, year, currency (opcional)

2. **`backend/internal/reporting/application/dtos/annual_report_output.go`**
   - DTO de saída com informações completas do relatório anual
   - Inclui: totais anuais, contagens, breakdown mensal (12 meses)

3. **`backend/internal/reporting/application/usecases/annual_report_usecase.go`**
   - Use case principal para geração de relatórios anuais
   - Filtra transações por período (ano)
   - Calcula totais de receitas e despesas anuais
   - Calcula saldo anual (receitas - despesas)
   - Gera breakdown mensal (todos os 12 meses)
   - Suporta filtro opcional por moeda

4. **`backend/internal/reporting/application/usecases/annual_report_usecase_test.go`**
   - Testes unitários completos
   - Testa cálculo correto de totais anuais
   - Testa breakdown mensal
   - Testa validação de entrada
   - Cobertura de casos de erro

### Funcionalidades

- ✅ Geração de relatório anual por usuário
- ✅ Cálculo de receitas totais anuais
- ✅ Cálculo de despesas totais anuais
- ✅ Cálculo de saldo anual (receitas - despesas)
- ✅ Contagem de transações por tipo
- ✅ Breakdown mensal (12 meses)
- ✅ Filtro opcional por moeda
- ✅ Validação de entrada (user_id, year)
- ✅ Testes unitários completos

### Estrutura do Relatório

O relatório anual retorna:
- Informações do período (ano)
- Total de receitas anuais (income)
- Total de despesas anuais (expense)
- Saldo anual (balance = income - expense)
- Contagem de transações (income_count, expense_count, total_count)
- Moeda utilizada
- Breakdown mensal com 12 entradas (uma para cada mês)

### Breakdown Mensal

Cada entrada do breakdown mensal contém:
- Mês (1-12)
- Total de receitas do mês
- Total de despesas do mês
- Saldo do mês
- Contagem de transações por tipo

### Testes

```bash
cd backend
go test ./internal/reporting/application/usecases/... -v -run TestAnnualReportUseCase
```

**Resultado:** ✅ Todos os testes passando

### Dependências

- ✅ REP-001: Use case para relatório mensal (base para estrutura)

### Próximos Passos

- REP-003: Criar use case para relatório por categoria
- REP-004: Criar use case para receitas vs despesas

---

**Autor:** Sistema de Gestão Financeira  
**Data:** 2025-12-27


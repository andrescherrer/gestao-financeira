# VAL-002 - Melhorar error handling no backend (error types)

**Data:** 2025-12-27  
**Status:** ✅ Concluída  
**Sprint:** 2.6 - Validações e Error Handling

## Resumo da Implementação

**Tarefa:** VAL-002 - Melhorar error handling no backend (error types)

### Arquivos Criados

1. **`backend/pkg/errors/errors.go`**
   - Tipo `ErrorType` com constantes para tipos de erro
   - Struct `AppError` com tipo, mensagem, código HTTP e detalhes
   - Funções auxiliares para criar erros tipados:
     - `NewValidationError()` - Erros de validação
     - `NewDomainError()` - Erros de domínio/regra de negócio
     - `NewNotFoundError()` - Recursos não encontrados
     - `NewConflictError()` - Conflitos (duplicatas)
     - `NewUnauthorizedError()` - Não autorizado
     - `NewForbiddenError()` - Acesso negado
     - `NewInternalError()` - Erros internos
     - `WrapError()` - Envolver erros existentes
   - Funções auxiliares:
     - `IsAppError()` - Verificar se é AppError
     - `AsAppError()` - Converter para AppError

### Tipos de Erro Definidos

```go
const (
    ErrorTypeValidation ErrorType = "VALIDATION_ERROR"
    ErrorTypeDomain     ErrorType = "DOMAIN_ERROR"
    ErrorTypeNotFound   ErrorType = "NOT_FOUND"
    ErrorTypeConflict   ErrorType = "CONFLICT"
    ErrorTypeUnauthorized ErrorType = "UNAUTHORIZED"
    ErrorTypeForbidden  ErrorType = "FORBIDDEN"
    ErrorTypeInternal   ErrorType = "INTERNAL_ERROR"
)
```

### Características

- ✅ Tipos de erro bem definidos
- ✅ Códigos HTTP mapeados automaticamente
- ✅ Suporte a detalhes adicionais (map[string]interface{})
- ✅ Wrapping de erros existentes
- ✅ Implementa interface `error` padrão do Go
- ✅ Suporte a `Unwrap()` para error wrapping

### Estrutura do AppError

```go
type AppError struct {
    Type    ErrorType              // Tipo do erro
    Message string                 // Mensagem de erro
    Code    int                    // Código HTTP
    Details map[string]interface{} // Detalhes adicionais (opcional)
    Err     error                  // Erro original (opcional)
}
```

### Exemplo de Uso

```go
// Criar erro de validação
err := errors.NewValidationError("Validation failed", map[string]interface{}{
    "fields": map[string]string{
        "email": "email is required",
        "password": "password must be at least 8 characters",
    },
})

// Criar erro de domínio
err := errors.NewDomainError("Account balance cannot be negative", originalErr)

// Criar erro de não encontrado
err := errors.NewNotFoundError("Account", accountID)

// Criar erro de conflito
err := errors.NewConflictError("Account with this name already exists")

// Verificar tipo de erro
if appErr, ok := errors.AsAppError(err); ok {
    switch appErr.Type {
    case errors.ErrorTypeValidation:
        // Tratar erro de validação
    case errors.ErrorTypeNotFound:
        // Tratar erro de não encontrado
    }
}
```

### Integração

- ✅ Usado pelo validador para retornar erros de validação
- ✅ Usado pelo middleware de tratamento de erros
- ✅ Pode ser usado em use cases e handlers
- ✅ Compatível com error handling padrão do Go

### Commits Realizados

- `feat(sprint-2.6): implementar validações e error handling robusto`

### Próxima Tarefa

VAL-003 - Criar middleware de tratamento de erros global


# BUD-005: Criar migration para tabela budgets

**Data:** 2025-12-27 09:43:47  
**Sprint:** 3.1 - Budget Context - Backend  
**Status:** ✅ Completo

## Resumo

Criação da migration SQL para criar a tabela `budgets` no banco de dados. A migration define a estrutura completa da tabela, incluindo colunas, tipos, índices e constraints.

## Implementação

### Arquivos Criados

- `migrations/007_create_budgets_table.sql`

### Estrutura da Tabela

```sql
CREATE TABLE budgets (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL,
    category_id UUID NOT NULL,
    amount_cents BIGINT NOT NULL,
    currency VARCHAR(3) NOT NULL,
    period_type VARCHAR(10) NOT NULL,
    year INTEGER NOT NULL,
    month INTEGER,
    context VARCHAR(10) NOT NULL,
    is_active BOOLEAN NOT NULL DEFAULT true,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (category_id) REFERENCES categories(id)
);
```

### Índices Criados

- Índice único em `(category_id, period_type, year, month)` para prevenir duplicatas
- Índice em `user_id` para consultas rápidas por usuário
- Índice em `category_id` para consultas rápidas por categoria

### Constraints

- Foreign keys para `users` e `categories`
- Check constraint para `period_type` (MONTHLY ou YEARLY)
- Check constraint para `context` (PERSONAL ou BUSINESS)
- Check constraint para `currency` (BRL, USD, EUR)
- Check constraint para `year` (1900-3000)
- Check constraint para `month` (1-12 ou NULL)

### Características

- Suporte a períodos mensais e anuais
- Validação de dados no nível de banco
- Timestamps automáticos
- Soft delete via `is_active`

## Padrão Seguido

Seguido o mesmo padrão usado nas migrations de `accounts`, `transactions` e `categories`, garantindo consistência na estrutura do banco de dados.


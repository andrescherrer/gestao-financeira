# INT-003 - Implementar atualização de saldo ao deletar transação

**Data:** 2025-01-27  
**Status:** ✅ Concluída

## Resumo da Implementação

**Tarefa:** INT-003 - Implementar atualização de saldo ao deletar transação

### Arquivos Criados

1. **`backend/internal/transaction/domain/events/transaction_deleted.go`**
   - Evento de domínio `TransactionDeleted`
   - Contém informações da transação deletada para reversão do saldo

### Arquivos Modificados

1. **`backend/internal/transaction/application/usecases/delete_transaction_usecase.go`**
   - Adicionado `eventBus` como dependência
   - Captura informações da transação ANTES de deletar
   - Publica evento `TransactionDeleted` após deletar

2. **`backend/cmd/api/main.go`**
   - Atualizado para passar `eventBus` para `DeleteTransactionUseCase`

### Características

- ✅ Captura informações da transação antes de deletar
- ✅ Publica evento `TransactionDeleted` com informações necessárias
- ✅ Handler reverte o efeito da transação no saldo

### Estrutura do Evento

```go
type TransactionDeleted struct {
    events.BaseDomainEvent
    accountID       string
    transactionType string // INCOME or EXPENSE
    amount          int64  // Amount in cents
    currency        string
}
```

### Funcionamento

1. **Captura de Informações:**
   ```go
   accountID := transaction.AccountID().Value()
   transactionType := transaction.TransactionType().Value()
   amount := transaction.Amount()
   ```

2. **Deleção da Transação:**
   - Use case deleta transação (soft delete)

3. **Publicação do Evento:**
   - Publica `TransactionDeleted` com informações capturadas
   - Handler reverte o efeito no saldo

### Handler

O `UpdateBalanceHandler.HandleTransactionDeleted()`:
- Se era INCOME: debita o valor (reverte crédito)
- Se era EXPENSE: credita o valor (reverte débito)

### Testes

- ✅ Teste unitário: Deleção de transação INCOME reverte crédito
- ✅ Teste unitário: Deleção de transação EXPENSE reverte débito
- ✅ Testes verificam que saldo é revertido corretamente

### Commits Realizados

- `feat(backend): INT-003 - implementar atualização de saldo ao deletar transação`

### Próxima Tarefa

INT-006 - Testes de integração Transaction ↔ Account


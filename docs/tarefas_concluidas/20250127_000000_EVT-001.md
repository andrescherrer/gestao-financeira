# EVT-001 - Expandir Event Bus com retry e error handling

**Data:** 2025-01-27  
**Status:** ✅ Concluída

## Resumo da Implementação

**Tarefa:** EVT-001 - Expandir Event Bus com retry e error handling

### Arquivos Modificados

1. **`backend/internal/shared/infrastructure/eventbus/event_bus.go`**
   - Adicionado `RetryConfig` para configurar comportamento de retry
   - Adicionado `HandlerWrapper` para envolver handlers com retry logic
   - Adicionado `SetErrorCallback` para callbacks de erro
   - Implementado exponential backoff para retries
   - Logging estruturado para retries e erros

2. **`backend/internal/shared/infrastructure/eventbus/event_bus_test.go`**
   - Testes completos para retry logic
   - Testes para error callbacks
   - Testes para exponential backoff

### Características

- ✅ Retry automático com exponential backoff
- ✅ Configuração customizável de retry por handler
- ✅ Error callbacks para tratamento de erros
- ✅ Logging estruturado de retries e erros
- ✅ Thread-safe com mutex

### RetryConfig

```go
type RetryConfig struct {
    MaxRetries        int           // Número máximo de tentativas
    InitialDelay      time.Duration // Delay inicial antes do primeiro retry
    MaxDelay          time.Duration // Delay máximo entre retries
    BackoffMultiplier float64       // Multiplicador para exponential backoff
}
```

### HandlerWrapper

- Envolve handlers com lógica de retry
- Implementa exponential backoff
- Logging de tentativas e sucessos/falhas

### Métodos Adicionados

- `SubscribeWithRetry()` - Registra handler com configuração de retry customizada
- `SetErrorCallback()` - Define callback para erros
- `NewEventBusWithConfig()` - Cria EventBus com configuração customizada
- `DefaultRetryConfig()` - Retorna configuração padrão

### Configuração Padrão

- MaxRetries: 3
- InitialDelay: 100ms
- MaxDelay: 5s
- BackoffMultiplier: 2.0

### Testes

- ✅ Handler sucede na primeira tentativa
- ✅ Handler sucede após retries
- ✅ Handler falha após todos os retries
- ✅ Error callback é chamado
- ✅ Exponential backoff funciona corretamente

### Commits Realizados

- `feat(backend): EVT-001 - expandir Event Bus com retry e error handling`

### Próxima Tarefa

EVT-002 - Criar domain events para User (UserRegistered, etc.)


# INT-005 - Criar handler para atualizar saldo via event bus

**Data:** 2025-01-27  
**Status:** ✅ Concluída

## Resumo da Implementação

**Tarefa:** INT-005 - Criar handler para atualizar saldo via event bus

### Arquivos Criados

1. **`backend/internal/account/infrastructure/handlers/update_balance_handler.go`**
   - Handler para atualizar saldo da conta baseado em eventos de transação
   - Trata três tipos de eventos: TransactionCreated, TransactionUpdated, TransactionDeleted

2. **`backend/internal/account/infrastructure/handlers/update_balance_handler_test.go`**
   - Testes unitários completos para o handler
   - Cobre todos os cenários de atualização de saldo

### Características

- ✅ Handler registrado no Event Bus para escutar eventos de transação
- ✅ Atualiza saldo automaticamente quando transação é criada
- ✅ Reverte e reaplica saldo quando transação é atualizada
- ✅ Reverte saldo quando transação é deletada
- ✅ Logging estruturado para rastreabilidade
- ✅ Tratamento de erros robusto

### Handlers Implementados

1. **HandleTransactionCreated**
   - INCOME: Credita (adiciona) ao saldo
   - EXPENSE: Debita (subtrai) do saldo

2. **HandleTransactionUpdated**
   - Reverte o efeito da transação antiga
   - Aplica o efeito da nova transação
   - Suporta mudança de tipo (INCOME ↔ EXPENSE)
   - Suporta mudança de valor

3. **HandleTransactionDeleted**
   - INCOME: Reverte crédito (debita)
   - EXPENSE: Reverte débito (credita)

### Integração

- ✅ Handler registrado no `main.go` após inicialização do Event Bus
- ✅ Subscrito aos eventos: TransactionCreated, TransactionUpdated, TransactionDeleted
- ✅ Usa AccountRepository para buscar e salvar contas

### Testes

- ✅ Teste para TransactionCreated (INCOME e EXPENSE)
- ✅ Teste para TransactionDeleted (INCOME e EXPENSE)
- ✅ Teste para TransactionUpdated (mudança de valor e tipo)
- ✅ Todos os testes passando

### Commits Realizados

- `feat(backend): INT-005 - criar handler para atualizar saldo via event bus`

### Próxima Tarefa

INT-001 - Implementar atualização de saldo ao criar transação


# OPT-005: Configurar PWA (Progressive Web App)

**Data:** 2025-12-31  
**Status:** ✅ Completo

## Objetivo

Configurar a aplicação como Progressive Web App (PWA), permitindo que usuários instalem a aplicação em seus dispositivos e tenham uma experiência similar a um aplicativo nativo, com funcionalidades offline e atualizações automáticas.

## Implementação

### 1. Instalação de Dependências

Instalado `vite-plugin-pwa` para integração com Vite:
```bash
npm install -D vite-plugin-pwa
```

### 2. Configuração do Plugin PWA

Configurado no `vite.config.ts`:
- **Manifest**: Configuração completa do Web App Manifest
- **Service Worker**: Geração automática com Workbox
- **Auto Update**: Atualizações automáticas do service worker
- **Runtime Caching**: Cache inteligente para API e imagens

### 3. Web App Manifest

Criado `manifest.webmanifest` com:
- Nome e descrição da aplicação
- Ícones em múltiplos tamanhos (192x192, 512x512)
- Tema e cores de fundo
- Modo de exibição standalone
- Orientação portrait

### 4. Service Worker

Gerado automaticamente com Workbox:
- **Precache**: Cache de assets estáticos
- **Runtime Caching**:
  - API: NetworkFirst (5 minutos de cache)
  - Imagens: CacheFirst (30 dias de cache)
- **Auto Update**: Atualizações automáticas em background
- **Skip Waiting**: Ativação imediata de novas versões

### 5. Ícones PWA

Criados ícones em múltiplos formatos:
- `pwa-192x192.png` - Ícone padrão
- `pwa-512x512.png` - Ícone grande
- `apple-touch-icon.png` - Para iOS (180x180)
- `mask-icon.png` - Para Safari (512x512)
- Script `generate-pwa-icons.js` para gerar ícones a partir de SVG

### 6. Componente de Atualização

Criado `PWAUpdatePrompt.vue`:
- Notifica usuário sobre novas versões
- Permite atualização manual ou automática
- Verifica atualizações periodicamente (a cada hora)

### 7. Meta Tags

Adicionadas meta tags no `index.html`:
- Apple touch icon
- Mask icon para Safari
- Theme color
- Apple mobile web app capabilities

## Funcionalidades

### Instalação
- ✅ Usuários podem instalar a aplicação em dispositivos móveis e desktop
- ✅ Ícone na tela inicial
- ✅ Experiência standalone (sem barra do navegador)

### Offline
- ✅ Cache de assets estáticos
- ✅ Cache de imagens
- ✅ Cache de respostas da API (com expiração)

### Atualizações
- ✅ Atualizações automáticas em background
- ✅ Notificação ao usuário sobre novas versões
- ✅ Atualização sob demanda

### Performance
- ✅ Cache inteligente reduz requisições
- ✅ Carregamento mais rápido em visitas subsequentes
- ✅ Funciona offline (com dados em cache)

## Arquivos Modificados/Criados

1. `frontend/vite.config.ts`
   - Adicionado plugin VitePWA
   - Configuração de manifest e service worker

2. `frontend/index.html`
   - Adicionadas meta tags PWA
   - Links para ícones

3. `frontend/src/components/PWAUpdatePrompt.vue` (novo)
   - Componente para notificar atualizações

4. `frontend/src/App.vue`
   - Integrado PWAUpdatePrompt

5. `frontend/public/pwa-192x192.png` (novo)
   - Ícone PWA 192x192

6. `frontend/public/pwa-512x512.png` (novo)
   - Ícone PWA 512x512

7. `frontend/public/pwa-192x192.svg` (novo)
   - SVG source para ícone 192x192

8. `frontend/public/pwa-512x512.svg` (novo)
   - SVG source para ícone 512x512

9. `frontend/public/apple-touch-icon.png` (novo)
   - Ícone para iOS

10. `frontend/public/mask-icon.png` (novo)
    - Ícone para Safari

11. `frontend/scripts/generate-pwa-icons.js` (novo)
    - Script para gerar ícones PNG a partir de SVG

12. `frontend/package.json`
    - Adicionado script `generate-pwa-icons`
    - Adicionada dependência `vite-plugin-pwa`

## Arquivos Gerados (Build)

Após build, os seguintes arquivos são gerados automaticamente:
- `dist/manifest.webmanifest` - Manifest da aplicação
- `dist/sw.js` - Service Worker
- `dist/registerSW.js` - Script de registro do service worker
- `dist/workbox-*.js` - Biblioteca Workbox

## Como Usar

### Instalação no Dispositivo

**Android (Chrome):**
1. Abrir aplicação no navegador
2. Menu → "Adicionar à tela inicial"
3. Aplicação aparecerá como app nativo

**iOS (Safari):**
1. Abrir aplicação no Safari
2. Compartilhar → "Adicionar à Tela de Início"
3. Aplicação aparecerá como app nativo

**Desktop (Chrome/Edge):**
1. Abrir aplicação no navegador
2. Ícone de instalação na barra de endereços
3. Clicar para instalar

### Gerar Ícones

Para gerar ícones PNG a partir de SVG:
```bash
npm run generate-pwa-icons
```

## Testes

- ✅ Build completo sem erros
- ✅ Type checking passa
- ✅ Linter sem erros
- ✅ Manifest gerado corretamente
- ✅ Service Worker gerado corretamente
- ✅ Ícones criados

## Benefícios

1. **Instalável**: Usuários podem instalar como app nativo
2. **Offline**: Funciona parcialmente offline com cache
3. **Performance**: Cache reduz requisições e melhora velocidade
4. **UX**: Experiência similar a app nativo
5. **Atualizações**: Atualizações automáticas sem intervenção do usuário
6. **SEO**: Melhor classificação em motores de busca (PWA é um sinal positivo)

## Próximos Passos (Opcional)

- [ ] Criar ícones profissionais (substituir placeholders)
- [ ] Implementar sincronização offline (IndexedDB)
- [ ] Adicionar notificações push
- [ ] Configurar splash screen customizado
- [ ] Adicionar shortcuts na tela inicial
- [ ] Implementar share target API

## Referências

- [Vite PWA Plugin](https://vite-pwa-org.netlify.app/)
- [Web App Manifest](https://developer.mozilla.org/en-US/docs/Web/Manifest)
- [Service Workers](https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API)
- [Workbox](https://developers.google.com/web/tools/workbox)


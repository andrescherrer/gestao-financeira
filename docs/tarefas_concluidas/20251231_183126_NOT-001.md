# NOT-001: Criar entidade Notification

**Data:** 2025-12-31  
**Tarefa:** NOT-001  
**Status:** ‚úÖ Completo  
**Tipo:** üîµ Backend | Domain

---

## üìã Problema

Para implementar o sistema de notifica√ß√µes, era necess√°rio criar a entidade de dom√≠nio `Notification` e seus value objects relacionados, seguindo os princ√≠pios de Domain-Driven Design (DDD) e os padr√µes estabelecidos no projeto.

---

## ‚úÖ Solu√ß√£o Implementada

Foram implementados:

1. **Value Objects** - Objetos de valor imut√°veis para Notification
2. **Entidade Notification** - Agregado raiz do contexto de notifica√ß√µes
3. **Eventos de Dom√≠nio** - Evento NotificationCreated
4. **Testes Unit√°rios** - Cobertura completa de testes para entidade e value objects

---

## üìÅ Arquivos Criados

### Value Objects
- `backend/internal/notification/domain/valueobjects/notification_id.go` - Identificador √∫nico da notifica√ß√£o
- `backend/internal/notification/domain/valueobjects/notification_type.go` - Tipo da notifica√ß√£o (INFO, WARNING, SUCCESS, ERROR)
- `backend/internal/notification/domain/valueobjects/notification_status.go` - Status da notifica√ß√£o (UNREAD, READ, ARCHIVED)
- `backend/internal/notification/domain/valueobjects/notification_title.go` - T√≠tulo da notifica√ß√£o
- `backend/internal/notification/domain/valueobjects/notification_message.go` - Mensagem da notifica√ß√£o

### Domain Entity
- `backend/internal/notification/domain/entities/notification.go` - Entidade Notification

### Domain Events
- `backend/internal/notification/domain/events/notification_created.go` - Evento de cria√ß√£o de notifica√ß√£o

### Testes
- `backend/internal/notification/domain/entities/notification_test.go` - Testes da entidade
- `backend/internal/notification/domain/valueobjects/notification_id_test.go` - Testes do ID
- `backend/internal/notification/domain/valueobjects/notification_type_test.go` - Testes do tipo
- `backend/internal/notification/domain/valueobjects/notification_status_test.go` - Testes do status

---

## üîç Detalhes da Implementa√ß√£o

### Value Objects

#### NotificationID
- Identificador √∫nico UUID para notifica√ß√µes
- Valida√ß√£o de formato UUID
- M√©todos: `NewNotificationID`, `GenerateNotificationID`, `MustNotificationID`, `Value`, `Equals`, `IsEmpty`

#### NotificationType
- Tipos v√°lidos: `INFO`, `WARNING`, `SUCCESS`, `ERROR`
- Normaliza√ß√£o autom√°tica para uppercase
- M√©todos de verifica√ß√£o: `IsInfo`, `IsWarning`, `IsSuccess`, `IsError`

#### NotificationStatus
- Status v√°lidos: `UNREAD`, `READ`, `ARCHIVED`
- Normaliza√ß√£o autom√°tica para uppercase
- M√©todos de verifica√ß√£o: `IsUnread`, `IsRead`, `IsArchived`

#### NotificationTitle
- T√≠tulo da notifica√ß√£o (1-200 caracteres)
- Valida√ß√£o de comprimento m√≠nimo e m√°ximo
- Trim autom√°tico de espa√ßos

#### NotificationMessage
- Mensagem da notifica√ß√£o (1-1000 caracteres)
- Valida√ß√£o de comprimento m√≠nimo e m√°ximo
- Trim autom√°tico de espa√ßos

### Entidade Notification

A entidade `Notification` representa uma notifica√ß√£o no sistema e possui:

- **ID**: Identificador √∫nico
- **UserID**: ID do usu√°rio destinat√°rio
- **Title**: T√≠tulo da notifica√ß√£o
- **Message**: Mensagem da notifica√ß√£o
- **Type**: Tipo (INFO, WARNING, SUCCESS, ERROR)
- **Status**: Status (UNREAD, READ, ARCHIVED)
- **ReadAt**: Timestamp de leitura (nil se n√£o lida)
- **Metadata**: Dados adicionais (map[string]interface{})
- **CreatedAt**: Timestamp de cria√ß√£o
- **UpdatedAt**: Timestamp de atualiza√ß√£o

#### M√©todos Principais

- `NewNotification`: Cria uma nova notifica√ß√£o (status UNREAD por padr√£o)
- `NotificationFromPersistence`: Reconstr√≥i notifica√ß√£o a partir de dados persistidos
- `MarkAsRead`: Marca notifica√ß√£o como lida
- `MarkAsUnread`: Marca notifica√ß√£o como n√£o lida
- `Archive`: Arquiva a notifica√ß√£o
- `Unarchive`: Desarquiva a notifica√ß√£o
- `UpdateMetadata`: Atualiza os metadados da notifica√ß√£o

#### Regras de Neg√≥cio

1. Notifica√ß√µes s√£o criadas com status `UNREAD` por padr√£o
2. N√£o √© poss√≠vel marcar uma notifica√ß√£o arquivada como lida/n√£o lida
3. Ao desarquivar, o status √© restaurado para `READ` (se foi lida) ou `UNREAD` (se n√£o foi lida)
4. Metadados podem ser atualizados a qualquer momento

### Eventos de Dom√≠nio

#### NotificationCreated
- Publicado quando uma notifica√ß√£o √© criada
- Cont√©m: notificationID, userID, title, notifType

---

## üß™ Testes

### Cobertura de Testes

Todos os testes foram implementados e passaram com sucesso:

- ‚úÖ Testes de cria√ß√£o de notifica√ß√£o (valida√ß√µes)
- ‚úÖ Testes de marca√ß√£o como lida/n√£o lida
- ‚úÖ Testes de arquivamento/desarquivamento
- ‚úÖ Testes de atualiza√ß√£o de metadados
- ‚úÖ Testes de reconstru√ß√£o a partir de persist√™ncia
- ‚úÖ Testes de value objects (ID, Type, Status)

### Execu√ß√£o dos Testes

```bash
cd backend
go test ./internal/notification/domain/... -v
```

**Resultado:** Todos os testes passaram ‚úÖ

---

## üìä Estrutura de Dados

### Notification Entity

```go
type Notification struct {
    id        NotificationID
    userID    UserID
    title     NotificationTitle
    message   NotificationMessage
    notifType NotificationType
    status    NotificationStatus
    readAt    *time.Time
    metadata  map[string]interface{}
    createdAt time.Time
    updatedAt time.Time
    events    []DomainEvent
}
```

### Valida√ß√µes

- UserID: N√£o pode ser vazio
- Title: N√£o pode ser vazio, 1-200 caracteres
- Message: N√£o pode ser vazio, 1-1000 caracteres
- Type: Deve ser INFO, WARNING, SUCCESS ou ERROR
- Status: Deve ser UNREAD, READ ou ARCHIVED

---

## üîó Integra√ß√µes

A entidade Notification est√° preparada para:

- Integra√ß√£o com reposit√≥rio (pr√≥xima tarefa: NOT-002)
- Publica√ß√£o de eventos de dom√≠nio via EventBus
- Integra√ß√£o com sistema de WebSocket (tarefa: NOT-004)
- Cria√ß√£o de notifica√ß√µes a partir de eventos de outros contextos

---

## ‚úÖ Valida√ß√£o

- ‚úÖ Compila√ß√£o sem erros
- ‚úÖ Todos os testes unit√°rios passando
- ‚úÖ Valida√ß√µes de neg√≥cio implementadas
- ‚úÖ Padr√£o DDD seguido corretamente
- ‚úÖ Consist√™ncia com outras entidades do projeto

---

## üìù Notas

- A entidade Notification foi projetada para ser flex√≠vel, permitindo metadados adicionais que podem ser usados para armazenar informa√ß√µes contextuais (ex: ID de entidade relacionada, URL de a√ß√£o)
- O sistema de status permite rastrear o ciclo de vida completo de uma notifica√ß√£o
- Eventos de dom√≠nio est√£o preparados para integra√ß√£o com o EventBus do sistema

---

## üöÄ Pr√≥ximos Passos

- **NOT-002**: Implementar reposit√≥rio e use cases
- **NOT-003**: Criar handlers e rotas
- **NOT-004**: Implementar WebSocket para notifica√ß√µes em tempo real

---

**Autor:** Sistema de Gest√£o Financeira  
**Revis√£o:** 2025-12-31


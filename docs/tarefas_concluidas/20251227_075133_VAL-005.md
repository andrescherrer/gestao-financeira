# VAL-005 - Melhorar mensagens de erro no frontend

**Data:** 2025-12-27  
**Status:** ✅ Concluída  
**Sprint:** 2.6 - Validações e Error Handling

## Resumo da Implementação

**Tarefa:** VAL-005 - Melhorar mensagens de erro no frontend

### Arquivos Criados/Modificados

1. **`frontend/src/utils/errorTranslations.ts`**
   - Função `translateError()` expandida
   - Nova função `extractErrorMessage()` para extrair erros do backend
   - Suporte a `error_type` e `request_id`
   - Traduções expandidas para novos tipos de erro
   - Tratamento especial para erros de validação

2. **`frontend/src/api/client.ts`**
   - Logging melhorado com `error_type` e `request_id`
   - Melhor distinção entre erros de rede e HTTP

3. **Stores atualizadas:**
   - `frontend/src/stores/accounts.ts`
   - `frontend/src/stores/categories.ts`
   - `frontend/src/stores/transactions.ts`
   - Todas agora usam `extractErrorMessage()` em vez de `translateError()`

### Características

- ✅ Extração inteligente de mensagens de erro
- ✅ Suporte a diferentes formatos de erro (Axios, objeto, string)
- ✅ Tradução automática para português
- ✅ Tratamento especial para erros de validação
- ✅ Logging melhorado com contexto completo

### Função extractErrorMessage

```typescript
export function extractErrorMessage(error: any): string {
  // Se for string, usar diretamente
  if (typeof error === 'string') {
    return translateError(error)
  }

  // Se for objeto de erro do Axios
  if (error.response?.data) {
    const data = error.response.data
    
    // Verificar se tem mensagem de erro
    if (data.error) {
      return translateError(data.error, data.error_type)
    }
    
    // Verificar se tem mensagem genérica
    if (data.message) {
      return translateError(data.message, data.error_type)
    }
  }

  // Se for um objeto de erro genérico
  if (error.message) {
    return translateError(error.message, error.error_type)
  }

  return 'Erro desconhecido'
}
```

### Traduções Adicionadas

Novas traduções para tipos de erro:
- `VALIDATION_ERROR` → "Erro de validação"
- `DOMAIN_ERROR` → "Erro de regra de negócio"
- `NOT_FOUND` → "Não encontrado"
- `CONFLICT` → "Conflito"
- `UNAUTHORIZED` → "Não autorizado"
- `FORBIDDEN` → "Acesso negado"
- `INTERNAL_ERROR` → "Erro interno do servidor"

### Mensagens de Validação

Mensagens específicas para erros de validação:
- "is required" → "é obrigatório"
- "must be a valid" → "deve ser um"
- "must be at least" → "deve ter no mínimo"
- "must be at most" → "deve ter no máximo"
- "must be one of" → "deve ser um dos"
- "must be greater than" → "deve ser maior que"
- "must be a valid uuid" → "deve ser um UUID válido"
- "must be a valid email address" → "deve ser um endereço de email válido"

### Integração nas Stores

Todas as stores foram atualizadas para usar `extractErrorMessage()`:

```typescript
catch (err: any) {
  const { extractErrorMessage } = await import('@/utils/errorTranslations')
  error.value = extractErrorMessage(err)
  throw err
}
```

### Logging Melhorado

O API client agora loga informações adicionais:

```typescript
console.error('[API Client] Erro na requisição:', {
  url: error.config?.url,
  method: error.config?.method?.toUpperCase(),
  status: error.response?.status,
  errorType: errorData?.error_type,
  requestId: errorData?.request_id,
  errorDetails: errorData?.details,
})
```

### Commits Realizados

- `feat(sprint-2.6): implementar validações e error handling robusto`

### Próxima Tarefa

LOG-001 - Configurar logging estruturado completo


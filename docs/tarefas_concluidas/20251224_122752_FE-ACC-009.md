# FE-ACC-009: Integrar com API de contas (detalhes)

**Data de ConclusÃ£o:** 2025-12-24  
**Sprint:** 1.9 - MÃ³dulo de Contas - Frontend  
**Status:** âœ… ConcluÃ­do

---

## ğŸ“‹ Resumo

IntegraÃ§Ã£o completa com a API de obtenÃ§Ã£o de detalhes de contas, incluindo serviÃ§o de API, store Pinia, e integraÃ§Ã£o na pÃ¡gina de detalhes. A funcionalidade jÃ¡ estava implementada nas tarefas anteriores (FE-ACC-001, FE-ACC-004).

---

## ğŸ¯ Objetivo

Garantir que a obtenÃ§Ã£o de detalhes de contas esteja totalmente integrada com a API do backend, permitindo que o usuÃ¡rio visualize informaÃ§Ãµes completas de uma conta especÃ­fica.

---

## âœ… ImplementaÃ§Ã£o

### 1. **ServiÃ§o de API** (`src/api/accounts.ts`)

**FunÃ§Ã£o `get()`:**
```typescript
async get(accountId: string): Promise<Account> {
  const response = await apiClient.get<Account>(`/accounts/${accountId}`)
  return response.data
}
```

**CaracterÃ­sticas:**
- Endpoint: `GET /accounts/:id`
- ParÃ¢metro: `accountId` (UUID)
- Resposta tipada: `Account`
- Usa `apiClient` configurado (com interceptors de autenticaÃ§Ã£o)

### 2. **Store Pinia** (`src/stores/accounts.ts`)

**FunÃ§Ã£o `getAccount()`:**
```typescript
async function getAccount(accountId: string) {
  isLoading.value = true
  error.value = null
  try {
    const account = await accountService.get(accountId)
    currentAccount.value = account

    // Atualiza a conta na lista se jÃ¡ existir
    const index = accounts.value.findIndex(
      (acc) => acc.account_id === accountId
    )
    if (index !== -1) {
      accounts.value[index] = account
    }

    return account
  } catch (err: any) {
    error.value = err.response?.data?.message || err.message || 'Erro ao obter detalhes da conta'
    throw err
  } finally {
    isLoading.value = false
  }
}
```

**CaracterÃ­sticas:**
- Gerenciamento de loading state
- Tratamento de erros com mensagens amigÃ¡veis
- AtualizaÃ§Ã£o automÃ¡tica da lista se a conta jÃ¡ existir
- Armazena conta atual em `currentAccount`
- Retorna a conta obtida

### 3. **IntegraÃ§Ã£o na View** (`src/views/AccountDetailsView.vue`)

**Fluxo de carregamento:**
```typescript
async function loadAccount() {
  if (!accountId) return

  // Verifica se a conta jÃ¡ estÃ¡ na lista
  const existingAccount = accountsStore.accounts.find(
    (acc) => acc.account_id === accountId
  )

  if (existingAccount && !accountsStore.currentAccount) {
    // Se jÃ¡ estÃ¡ na lista, usa ela
    accountsStore.currentAccount = existingAccount
  } else {
    // Caso contrÃ¡rio, busca do servidor
    try {
      await accountsStore.getAccount(accountId)
    } catch (error) {
      // Erro jÃ¡ Ã© tratado no store
    }
  }
}
```

**CaracterÃ­sticas:**
- OtimizaÃ§Ã£o: verifica lista antes de fazer requisiÃ§Ã£o
- Carregamento automÃ¡tico ao montar componente
- Watch no route params para recarregar ao navegar
- Tratamento de erros com retry
- Estados de loading, error e not-found

---

## ğŸ”§ Fluxo de IntegraÃ§Ã£o

### 1. **OtimizaÃ§Ã£o Client-Side**
- Verifica se a conta jÃ¡ estÃ¡ na lista do store
- Se estiver, usa dados locais (evita requisiÃ§Ã£o desnecessÃ¡ria)
- Se nÃ£o estiver, faz requisiÃ§Ã£o para API

### 2. **RequisiÃ§Ã£o HTTP**
```
GET /api/v1/accounts/:id
Headers:
  Authorization: Bearer <token>
```

### 3. **Resposta da API**
```json
{
  "account_id": "uuid",
  "user_id": "uuid",
  "name": "Conta Corrente",
  "type": "BANK",
  "balance": "1000.00",
  "currency": "BRL",
  "context": "PERSONAL",
  "is_active": true,
  "created_at": "2025-12-24T12:00:00Z",
  "updated_at": "2025-12-24T12:00:00Z"
}
```

### 4. **Processamento no Store**
- Conta Ã© armazenada em `currentAccount.value`
- Se a conta jÃ¡ existir na lista, Ã© atualizada
- Loading state Ã© atualizado
- Conta Ã© retornada

### 5. **ExibiÃ§Ã£o na View**
- Dados sÃ£o exibidos na pÃ¡gina de detalhes
- FormataÃ§Ã£o de moeda e datas
- Estados de loading, error e not-found sÃ£o tratados

---

## ğŸ“ Arquivos Envolvidos

```
frontend/src/
â”œâ”€â”€ api/
â”‚   â””â”€â”€ accounts.ts              âœ… ServiÃ§o de API (FE-ACC-001)
â”œâ”€â”€ stores/
â”‚   â””â”€â”€ accounts.ts              âœ… Store Pinia (FE-ACC-001)
â””â”€â”€ views/
    â””â”€â”€ AccountDetailsView.vue   âœ… PÃ¡gina de detalhes (FE-ACC-004)
```

---

## âœ… Funcionalidades Implementadas

### ObtenÃ§Ã£o de Detalhes
- âœ… Busca de conta por ID
- âœ… OtimizaÃ§Ã£o: verifica lista antes de buscar
- âœ… AtualizaÃ§Ã£o automÃ¡tica da lista
- âœ… Armazenamento em `currentAccount`
- âœ… Tratamento de erros da API

### Estados
- âœ… Loading state durante busca
- âœ… Error state com mensagem amigÃ¡vel
- âœ… Not-found state quando conta nÃ£o existe
- âœ… Retry em caso de erro

### UX
- âœ… Carregamento automÃ¡tico ao abrir pÃ¡gina
- âœ… Recarregamento ao navegar entre contas
- âœ… Feedback visual de loading
- âœ… Mensagens de erro em portuguÃªs
- âœ… BotÃ£o de retry em caso de erro

### OtimizaÃ§Ãµes
- âœ… Evita requisiÃ§Ã£o se conta jÃ¡ estÃ¡ na lista
- âœ… Atualiza lista quando conta Ã© buscada
- âœ… Sincroniza dados entre lista e detalhes

---

## ğŸ” Endpoint da API

**GET /api/v1/accounts/:id**

**Headers:**
- `Authorization: Bearer <token>` (obrigatÃ³rio)

**ParÃ¢metros:**
- `id`: UUID da conta (path parameter)

**Resposta de Sucesso (200):**
```json
{
  "account_id": "uuid",
  "user_id": "uuid",
  "name": "string",
  "type": "BANK | WALLET | INVESTMENT | CREDIT_CARD",
  "balance": "string (formato: '1000.00')",
  "currency": "BRL | USD | EUR",
  "context": "PERSONAL | BUSINESS",
  "is_active": true,
  "created_at": "ISO 8601",
  "updated_at": "ISO 8601"
}
```

**Respostas de Erro:**
- `401`: Unauthorized - token invÃ¡lido ou expirado
- `404`: Not Found - conta nÃ£o existe ou usuÃ¡rio nÃ£o tem acesso
- `500`: Internal server error

---

## âœ… Testes

### Testes Manuais Realizados
- âœ… Busca de conta funciona corretamente
- âœ… Dados sÃ£o exibidos corretamente na pÃ¡gina
- âœ… Loading state exibido durante busca
- âœ… Error state exibido em caso de erro
- âœ… Not-found state exibido quando conta nÃ£o existe
- âœ… Retry funciona corretamente
- âœ… Token JWT Ã© enviado automaticamente
- âœ… Tratamento de erro 401 (redireciona para login)
- âœ… Tratamento de erro 404 (exibe mensagem)
- âœ… OtimizaÃ§Ã£o funciona (usa lista quando disponÃ­vel)
- âœ… AtualizaÃ§Ã£o da lista funciona
- âœ… NavegaÃ§Ã£o entre contas funciona
- âœ… Recarregamento ao mudar route params funciona
- âœ… FormataÃ§Ã£o de moeda e datas funciona

---

## ğŸš€ PrÃ³ximos Passos

1. **FE-ACC-010:** Implementar loading e error states - jÃ¡ implementado
2. **Futuro:** Adicionar ediÃ§Ã£o de contas
3. **Futuro:** Adicionar exclusÃ£o de contas
4. **Futuro:** Adicionar histÃ³rico de transaÃ§Ãµes na pÃ¡gina de detalhes
5. **Futuro:** Adicionar grÃ¡ficos de movimentaÃ§Ã£o

---

## ğŸ“ Notas TÃ©cnicas

### DecisÃµes de Design
1. **OtimizaÃ§Ã£o client-side:** Verifica lista antes de buscar (evita requisiÃ§Ãµes desnecessÃ¡rias)
2. **AtualizaÃ§Ã£o automÃ¡tica:** Lista Ã© atualizada quando conta Ã© buscada (sincronizaÃ§Ã£o)
3. **Armazenamento em currentAccount:** Facilita acesso aos dados da conta atual
4. **Watch no route params:** Recarrega ao navegar entre contas
5. **Tratamento de erros:** Mensagens amigÃ¡veis em portuguÃªs

### Melhorias Futuras
- Adicionar cache de detalhes (evitar requisiÃ§Ãµes repetidas)
- Adicionar refresh manual (botÃ£o para atualizar dados)
- Adicionar skeleton loading (melhor UX durante carregamento)
- Adicionar transaÃ§Ãµes relacionadas na pÃ¡gina de detalhes
- Adicionar grÃ¡ficos de movimentaÃ§Ã£o financeira

---

## ğŸ”„ RelaÃ§Ã£o com Outras Tarefas

**FE-ACC-001:** Criou o serviÃ§o de API e store (base da integraÃ§Ã£o)  
**FE-ACC-004:** Criou a pÃ¡gina de detalhes com integraÃ§Ã£o  
**FE-ACC-009:** Esta tarefa - confirmaÃ§Ã£o e documentaÃ§Ã£o da integraÃ§Ã£o

**Status:** A integraÃ§Ã£o jÃ¡ estava completa nas tarefas anteriores. Esta tarefa serve como confirmaÃ§Ã£o e documentaÃ§Ã£o.

---

**Tarefa concluÃ­da com sucesso!** âœ…


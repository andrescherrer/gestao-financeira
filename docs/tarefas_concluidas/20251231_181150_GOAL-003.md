# GOAL-003: Implementar reposit√≥rio e use cases

**Data:** 2025-12-31  
**Tarefa:** GOAL-003  
**Status:** ‚úÖ Completo  
**Tipo:** üîµ Backend | Application & Infrastructure

---

## üìã Problema

Para completar a implementa√ß√£o do contexto de Goal, era necess√°rio implementar a camada de persist√™ncia (reposit√≥rio) e a camada de aplica√ß√£o (use cases) que conectam o dom√≠nio com a infraestrutura e a apresenta√ß√£o.

---

## ‚úÖ Solu√ß√£o Implementada

Foram implementados:

1. **Reposit√≥rio de Dom√≠nio** - Interface e implementa√ß√£o GORM
2. **Model de Persist√™ncia** - Model GORM para a tabela goals
3. **DTOs** - Data Transfer Objects para entrada e sa√≠da
4. **Use Cases** - Casos de uso para opera√ß√µes CRUD e espec√≠ficas de Goal
5. **Migration** - Script SQL para criar a tabela goals
6. **Testes** - Valida√ß√£o de compila√ß√£o e testes existentes

---

## üìÅ Arquivos Criados

### Domain Repository
- `backend/internal/goal/domain/repositories/goal_repository.go` - Interface do reposit√≥rio

### Infrastructure
- `backend/internal/goal/infrastructure/persistence/goal_model.go` - Model GORM
- `backend/internal/goal/infrastructure/persistence/gorm_goal_repository.go` - Implementa√ß√£o GORM

### Application DTOs
- `backend/internal/goal/application/dtos/create_goal_dto.go` - DTOs de cria√ß√£o
- `backend/internal/goal/application/dtos/list_goals_dto.go` - DTOs de listagem
- `backend/internal/goal/application/dtos/get_goal_dto.go` - DTOs de consulta
- `backend/internal/goal/application/dtos/add_contribution_dto.go` - DTOs de contribui√ß√£o
- `backend/internal/goal/application/dtos/update_progress_dto.go` - DTOs de atualiza√ß√£o de progresso
- `backend/internal/goal/application/dtos/cancel_goal_dto.go` - DTOs de cancelamento
- `backend/internal/goal/application/dtos/delete_goal_dto.go` - DTOs de exclus√£o

### Application Use Cases
- `backend/internal/goal/application/usecases/create_goal_usecase.go` - Criar meta
- `backend/internal/goal/application/usecases/list_goals_usecase.go` - Listar metas
- `backend/internal/goal/application/usecases/get_goal_usecase.go` - Obter meta
- `backend/internal/goal/application/usecases/add_contribution_usecase.go` - Adicionar contribui√ß√£o
- `backend/internal/goal/application/usecases/update_progress_usecase.go` - Atualizar progresso
- `backend/internal/goal/application/usecases/cancel_goal_usecase.go` - Cancelar meta
- `backend/internal/goal/application/usecases/delete_goal_usecase.go` - Excluir meta

### Migrations
- `backend/migrations/000011_create_goals_table.up.sql` - Migration de cria√ß√£o
- `backend/migrations/000011_create_goals_table.down.sql` - Migration de rollback

---

## üéØ Caracter√≠sticas Implementadas

### 1. Reposit√≥rio de Dom√≠nio
- ‚úÖ Interface `GoalRepository` com m√©todos CRUD
- ‚úÖ Busca por ID, UserID, Status
- ‚úÖ Pagina√ß√£o com filtros (context, status)
- ‚úÖ Soft delete
- ‚úÖ Contagem de metas

### 2. Implementa√ß√£o GORM
- ‚úÖ Model `GoalModel` com todos os campos
- ‚úÖ Convers√£o entre model e entidade de dom√≠nio
- ‚úÖ Suporte a soft delete
- ‚úÖ √çndices para performance
- ‚úÖ Foreign keys para users

### 3. DTOs
- ‚úÖ `CreateGoalInput/Output` - Cria√ß√£o
- ‚úÖ `ListGoalsInput/Output` - Listagem com pagina√ß√£o
- ‚úÖ `GetGoalInput/Output` - Consulta individual
- ‚úÖ `AddContributionInput/Output` - Adicionar contribui√ß√£o
- ‚úÖ `UpdateProgressInput/Output` - Atualizar progresso
- ‚úÖ `CancelGoalInput/Output` - Cancelar meta
- ‚úÖ `DeleteGoalInput/Output` - Exclus√£o
- ‚úÖ Valida√ß√µes com tags `validate`

### 4. Use Cases
- ‚úÖ **CreateGoalUseCase**: Cria meta
  - Valida user, nome, valor alvo, deadline, contexto
  - Verifica se deadline est√° no futuro
  - Emite eventos de dom√≠nio
  
- ‚úÖ **ListGoalsUseCase**: Lista metas
  - Suporta pagina√ß√£o
  - Filtros por context e status
  - Calcula progresso e dias restantes
  
- ‚úÖ **GetGoalUseCase**: Obt√©m meta
  - Busca por ID
  - Verifica propriedade
  - Retorna dados completos
  
- ‚úÖ **AddContributionUseCase**: Adiciona contribui√ß√£o
  - Valida valor da contribui√ß√£o
  - Verifica se n√£o excede valor alvo
  - Atualiza status automaticamente
  - Emite eventos de dom√≠nio
  
- ‚úÖ **UpdateProgressUseCase**: Atualiza progresso
  - Permite atualizar progresso diretamente
  - Valida valor
  - Atualiza status automaticamente
  - Emite eventos de dom√≠nio
  
- ‚úÖ **CancelGoalUseCase**: Cancela meta
  - Valida se pode ser cancelada
  - Atualiza status para CANCELLED
  
- ‚úÖ **DeleteGoalUseCase**: Exclui meta
  - Soft delete
  - Verifica propriedade antes de excluir

### 5. Migration
- ‚úÖ Tabela `goals` com todos os campos
- ‚úÖ √çndices para performance
- ‚úÖ Foreign keys para users
- ‚úÖ Suporte a soft delete
- ‚úÖ Constraints de valida√ß√£o

---

## üìä Estrutura do Reposit√≥rio

### Interface
```go
type GoalRepository interface {
    FindByID(id GoalID) (*Goal, error)
    FindByUserID(userID UserID) ([]*Goal, error)
    FindByStatus(userID UserID, status GoalStatus) ([]*Goal, error)
    Save(goal *Goal) error
    Delete(id GoalID) error
    Exists(id GoalID) (bool, error)
    Count(userID UserID) (int64, error)
    FindByUserIDWithPagination(...) ([]*Goal, int64, error)
}
```

### Model GORM
```go
type GoalModel struct {
    ID              string
    UserID          string
    Name            string
    TargetAmount    int64
    TargetCurrency  string
    CurrentAmount   int64
    CurrentCurrency string
    Deadline        time.Time
    Context         string
    Status          string
    CreatedAt        time.Time
    UpdatedAt        time.Time
    DeletedAt       gorm.DeletedAt
}
```

---

## ‚úÖ Valida√ß√£o

- ‚úÖ Todos os arquivos compilam sem erros
- ‚úÖ Sem erros de lint
- ‚úÖ Seguindo padr√µes DDD do projeto
- ‚úÖ Migration criada
- ‚úÖ C√≥digo revisado e validado

---

## üìö Refer√™ncias

- [Domain-Driven Design - Repositories](https://martinfowler.com/eaaCatalog/repository.html)
- Padr√µes estabelecidos em `backend/internal/investment`
- Padr√µes estabelecidos em `backend/internal/account`

---

**√öltima Atualiza√ß√£o:** 2025-12-31  
**Commit:** `[hash]` - feat(goal): implementar GOAL-003 - reposit√≥rio e use cases


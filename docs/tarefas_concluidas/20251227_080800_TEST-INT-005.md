# TEST-INT-005 - Criar testes E2E básicos

**Data:** 2025-12-27  
**Status:** ✅ Concluída  
**Sprint:** 2.7 - Testes de Integração

## Resumo da Implementação

**Tarefa:** TEST-INT-005 - Criar testes E2E básicos (autenticação → criar conta → criar transação)

### Arquivos Criados

1. **`backend/tests/e2e/basic_flow_test.go`**
   - Testes E2E completos para fluxo principal
   - Testa fluxo completo: Register → Login → Create Account → Create Transaction
   - Testa autenticação e autorização

### Testes Implementados

- ✅ `TestE2E_BasicFlow` - Fluxo completo end-to-end
  - Registro de usuário
  - Login e obtenção de token JWT
  - Criação de conta (rota protegida)
  - Criação de transação (rota protegida)
- ✅ `TestE2E_UnauthorizedAccess` - Testa que rotas protegidas requerem autenticação
- ✅ `TestE2E_InvalidToken` - Testa que tokens inválidos são rejeitados

### Características

- ✅ Banco de dados em memória (SQLite)
- ✅ Aplicação Fiber completa configurada
- ✅ Todos os handlers e rotas configurados
- ✅ Middleware de autenticação aplicado
- ✅ Testes de requisições HTTP reais usando `httptest`

### Setup de Teste

```go
func setupTestApp(t *testing.T) (*fiber.App, *gorm.DB) {
    // Cria banco em memória
    // Inicializa repositórios, use cases, handlers
    // Configura rotas completas
    // Retorna app Fiber pronto para testes
}
```

### Fluxo Testado

1. **Registro de Usuário**
   ```http
   POST /api/v1/auth/register
   {
     "email": "e2e@example.com",
     "password": "password123",
     "first_name": "Teste",
     "last_name": "Usuario"
   }
   ```

2. **Login**
   ```http
   POST /api/v1/auth/login
   {
     "email": "e2e@example.com",
     "password": "password123"
   }
   ```

3. **Criar Conta (Protegida)**
   ```http
   POST /api/v1/accounts
   Authorization: Bearer <token>
   {
     "name": "Conta E2E",
     "type": "BANK",
     "initial_balance": 1000.00,
     "currency": "BRL",
     "context": "PERSONAL"
   }
   ```

4. **Criar Transação (Protegida)**
   ```http
   POST /api/v1/transactions
   Authorization: Bearer <token>
   {
     "account_id": "<account_id>",
     "type": "EXPENSE",
     "amount": 100.00,
     "currency": "BRL",
     "description": "Teste E2E",
     "date": "2025-12-27"
   }
   ```

### Validações

- ✅ Status codes corretos (201, 200, 401)
- ✅ Estrutura de resposta correta
- ✅ Token JWT válido
- ✅ Dados persistidos corretamente
- ✅ Rotas protegidas funcionando

### Commits Realizados

- `feat(sprint-2.7): implementar testes de integração`

### Sprint 2.7 - Status

✅ **Sprint 2.7: Testes de Integração - CONCLUÍDA**

Todas as tarefas da Sprint 2.7 foram concluídas:
- ✅ TEST-INT-001: Criar testes de integração para Identity Context
- ✅ TEST-INT-002: Criar testes de integração para Account Context
- ✅ TEST-INT-003: Criar testes de integração para Transaction Context
- ✅ TEST-INT-004: Criar testes de integração para Category Context
- ✅ TEST-INT-005: Criar testes E2E básicos


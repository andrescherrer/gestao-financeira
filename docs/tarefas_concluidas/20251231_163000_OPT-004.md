# OPT-004: Configurar Error Tracking (Sentry)

**Data:** 2025-12-31  
**Status:** ✅ Completo

## Objetivo

Configurar Sentry para rastreamento de erros no frontend, permitindo monitoramento em tempo real de erros em produção e melhorando a capacidade de debug e resolução de problemas.

## Implementação

### 1. Instalação de Dependências

Instalado `@sentry/vue` e `@sentry/tracing` para integração com Vue 3:
```bash
npm install @sentry/vue @sentry/tracing
```

### 2. Configuração do Sentry

Criado arquivo `src/config/sentry.ts` com:
- Inicialização do Sentry com configurações otimizadas
- Integração com Vue Router para rastreamento de navegação
- Session Replay para debug de erros
- Performance Monitoring (10% em produção, 100% em desenvolvimento)
- Filtros para ignorar erros conhecidos em desenvolvimento

### 3. Integração com Aplicação

#### main.ts
- Inicialização do Sentry antes de montar a aplicação
- Captura de erros globais do Vue (`errorHandler`)
- Captura de erros não tratados (`window.error`)
- Captura de promessas rejeitadas (`unhandledrejection`)

#### stores/auth.ts
- Atualização do contexto do usuário no Sentry ao fazer login
- Limpeza do contexto ao fazer logout
- Sincronização com o logger existente

#### utils/logger.ts
- Integração com Sentry para erros críticos
- Envio automático de erros para Sentry quando logger.error é chamado

### 4. Configuração de Ambiente

Adicionada variável de ambiente `VITE_SENTRY_DSN`:
- Opcional: Sentry só é inicializado se DSN estiver configurado
- Criado `.env.example` com exemplo de configuração
- Suporte para diferentes ambientes (development, staging, production)

## Funcionalidades

### Error Tracking
- ✅ Captura automática de erros JavaScript
- ✅ Captura de erros do Vue (component errors)
- ✅ Captura de promessas rejeitadas
- ✅ Contexto completo (stack trace, user, environment)

### Performance Monitoring
- ✅ Rastreamento de performance de navegação
- ✅ Integração com Vue Router
- ✅ Sample rate configurável por ambiente

### Session Replay
- ✅ Gravação de sessões com erros
- ✅ Gravação de 10% das sessões em produção
- ✅ Privacidade: máscara de texto e bloqueio de mídia

### User Context
- ✅ Identificação automática do usuário logado
- ✅ Atualização dinâmica ao fazer login/logout
- ✅ Sincronização com sistema de logging existente

## Arquivos Modificados/Criados

1. `frontend/src/config/sentry.ts` (novo)
   - Configuração completa do Sentry
   - Funções utilitárias para captura de erros

2. `frontend/src/config/env.ts`
   - Adicionada variável `sentryDsn`

3. `frontend/src/main.ts`
   - Inicialização do Sentry
   - Integração com error handlers globais

4. `frontend/src/stores/auth.ts`
   - Integração com Sentry para contexto do usuário

5. `frontend/src/utils/logger.ts`
   - Integração com Sentry para erros críticos

6. `frontend/.env.example` (novo)
   - Exemplo de configuração de variáveis de ambiente

7. `frontend/package.json`
   - Adicionadas dependências `@sentry/vue` e `@sentry/tracing`

## Configuração

### Variáveis de Ambiente

Adicionar ao `.env`:
```env
VITE_SENTRY_DSN=https://your-dsn@sentry.io/project-id
```

### Obter DSN do Sentry

1. Criar conta em https://sentry.io
2. Criar novo projeto (Vue)
3. Copiar DSN das configurações do projeto
4. Adicionar ao `.env`

## Testes

- ✅ Type checking passa
- ✅ Linter sem erros
- ✅ Build completo sem erros
- ✅ Sentry inicializa apenas se DSN estiver configurado
- ✅ Erros são capturados e enviados para Sentry

## Benefícios

1. **Monitoramento em Tempo Real**: Erros são reportados imediatamente
2. **Contexto Rico**: Stack traces, contexto do usuário, ambiente
3. **Performance Insights**: Métricas de performance e navegação
4. **Session Replay**: Visualização de sessões com erros
5. **Integração Suave**: Funciona com sistema de logging existente
6. **Opcional**: Não quebra a aplicação se não estiver configurado

## Próximos Passos (Opcional)

- [ ] Configurar alertas no Sentry
- [ ] Adicionar tags customizadas para categorização
- [ ] Configurar releases para rastreamento de versões
- [ ] Integrar com CI/CD para upload de source maps
- [ ] Configurar rate limiting customizado

## Referências

- [Sentry Vue Documentation](https://docs.sentry.io/platforms/javascript/guides/vue/)
- [Sentry Session Replay](https://docs.sentry.io/platforms/javascript/session-replay/)
- [Sentry Performance Monitoring](https://docs.sentry.io/product/performance/)


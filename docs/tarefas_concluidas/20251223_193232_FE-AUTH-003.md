# FE-AUTH-003 - Criar hook useAuth para gerenciar autenticação

**Data:** 2025-12-23  
**Status:** ✅ Concluída

## Resumo da Implementação

**Tarefa:** FE-AUTH-003 - Criar hook useAuth para gerenciar autenticação

### Arquivos Criados

1. **`lib/hooks/useAuth.ts`**
   - Hook customizado para gerenciar autenticação
   - Integração com TanStack Query
   - Gerenciamento de estado de autenticação
   - Mutations para login e registro
   - Função de logout
   - Cache de autenticação

### Arquivos Modificados

1. **`app/login/page.tsx`**
   - Refatorado para usar `useAuth` hook
   - Simplificado código removendo lógica duplicada
   - Usa `isLoggingIn` e `loginError` do hook

2. **`app/register/page.tsx`**
   - Refatorado para usar `useAuth` hook
   - Simplificado código removendo lógica duplicada
   - Usa `isRegistering` e `registerError` do hook

### Funcionalidades do Hook

#### Estado
- ✅ `user`: Dados do usuário autenticado
- ✅ `isAuthenticated`: Boolean indicando se está autenticado
- ✅ `isLoading`: Boolean indicando se está carregando
- ✅ `isLoggingIn`: Boolean indicando se está fazendo login
- ✅ `isRegistering`: Boolean indicando se está registrando
- ✅ `loginError`: Erro do login (se houver)
- ✅ `registerError`: Erro do registro (se houver)

#### Ações
- ✅ `login(credentials)`: Função para fazer login
- ✅ `register(userData)`: Função para registrar usuário
- ✅ `logout()`: Função para fazer logout

### Integração com TanStack Query

#### Query de Autenticação
- Query key: `["auth"]`
- Verifica token no localStorage
- Cache de 5 minutos
- Não faz retry automático

#### Mutations
- **Login Mutation**:
  - Salva token após sucesso
  - Atualiza cache de autenticação
  - Invalida queries de contas e transações
  - Redireciona para dashboard

- **Register Mutation**:
  - Registra novo usuário
  - Redireciona para login após sucesso

#### Cache Management
- Atualiza cache de autenticação após login
- Limpa cache ao fazer logout
- Invalida queries relacionadas após login/logout

### Fluxo de Autenticação

#### Login
1. Usuário chama `login(credentials)`
2. Mutation executa `authService.login()`
3. Token é salvo no localStorage
4. Dados do usuário são salvos no estado
5. Cache é atualizado
6. Queries relacionadas são invalidadas
7. Redirecionamento para dashboard

#### Registro
1. Usuário chama `register(userData)`
2. Mutation executa `authService.register()`
3. Redirecionamento para login

#### Logout
1. Usuário chama `logout()`
2. Token é removido do localStorage
3. Estado do usuário é limpo
4. Cache é limpo
5. Todas as queries são invalidadas
6. Redirecionamento para login

### Uso do Hook

```typescript
import { useAuth } from "@/lib/hooks/useAuth";

function MyComponent() {
  const { user, isAuthenticated, login, logout, isLoading } = useAuth();

  if (isLoading) return <div>Carregando...</div>;

  if (!isAuthenticated) {
    return <button onClick={() => login({ email, password })}>Login</button>;
  }

  return (
    <div>
      <p>Olá, {user?.full_name}</p>
      <button onClick={logout}>Sair</button>
    </div>
  );
}
```

### Benefícios

1. **Centralização**: Toda lógica de autenticação em um único lugar
2. **Reutilização**: Pode ser usado em qualquer componente
3. **Cache**: Gerenciamento automático de cache com TanStack Query
4. **Estado**: Estado sincronizado em toda a aplicação
5. **Type Safety**: Totalmente tipado com TypeScript
6. **Simplicidade**: API simples e intuitiva

### Próximos Passos

Este hook será usado em:
- **FE-AUTH-004**: Proteção de rotas (verificar autenticação)
- **FE-ACC-001**: Hooks de contas (usar autenticação)
- **FE-TX-001**: Hooks de transações (usar autenticação)
- **Header**: Mostrar usuário logado e botão de logout

### Testes Realizados

- ✅ Hook criado e funcionando
- ✅ Integração com TanStack Query funcionando
- ✅ Login mutation funcionando
- ✅ Register mutation funcionando
- ✅ Logout funcionando
- ✅ Cache management funcionando
- ✅ Páginas de login e registro refatoradas
- ✅ `npm run build` - Build do projeto passou
- ✅ TypeScript sem erros

### Melhorias Futuras

- Adicionar validação de token no servidor
- Adicionar refresh token automático
- Adicionar persistência de sessão
- Adicionar verificação de expiração de token
- Adicionar testes automatizados

### Próxima Tarefa

FE-AUTH-004 - Implementar proteção de rotas (middleware)

### Commits Realizados

- `feat: FE-AUTH-003 - criar hook useAuth para gerenciar autenticação`


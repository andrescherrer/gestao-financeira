# CONFIG-001 - Configuração Centralizada

**Data:** 2025-12-28  
**Status:** ✅ Concluída

## Resumo da Implementação

**Tarefa:** CONFIG-001 - Configuração Centralizada

### Arquivos Criados/Modificados

1. **`backend/pkg/config/config.go`**
   - Struct `Config` centralizada com todas as configurações
   - Structs aninhadas: `ServerConfig`, `DatabaseConfig`, `JWTConfig`, `RedisConfig`, `LoggingConfig`, `MigrationsConfig`, `CORSConfig`
   - Função `Load()` para carregar configuração de variáveis de ambiente
   - Função `Validate()` para validar configuração
   - Funções helper: `IsProduction()`, `IsDevelopment()`, `IsStaging()`

2. **`backend/pkg/config/config_test.go`**
   - Testes unitários completos (15+ casos de teste)
   - Testes de carregamento com defaults
   - Testes de carregamento com variáveis de ambiente
   - Testes de validação
   - Testes de parsing de duration e int

3. **`backend/CONFIG.md`**
   - Documentação completa de todas as variáveis de ambiente
   - Valores padrão
   - Exemplos de uso
   - Descrição de cada configuração

4. **`backend/cmd/api/main.go`**
   - Refatorado para usar `config.Load()`
   - Todas as configurações agora vêm do struct centralizado
   - Validação de configuração no startup

5. **`backend/pkg/database/database.go`**
   - Modificado para aceitar `config.DatabaseConfig`
   - Função `NewDatabaseWithConfig()`

6. **`backend/internal/identity/infrastructure/services/jwt_service.go`**
   - Modificado para aceitar `config.JWTConfig`
   - Função `NewJWTServiceWithConfig()`

7. **`backend/pkg/logger/logger.go`**
   - Modificado para aceitar `config.LoggingConfig`
   - Função `InitLoggerWithConfig()`

### Características

- ✅ Configuração centralizada em um único struct
- ✅ Validação robusta de configuração
- ✅ Valores padrão sensatos para todos os campos
- ✅ Suporte a múltiplos ambientes (dev, staging, production)
- ✅ Documentação completa
- ✅ Testes unitários completos

### Estrutura de Configuração

```go
type Config struct {
    Environment string
    Server      ServerConfig
    Database    DatabaseConfig
    JWT         JWTConfig
    Redis       RedisConfig
    Logging     LoggingConfig
    Migrations  MigrationsConfig
    CORS        CORSConfig
}
```

### Variáveis de Ambiente Suportadas

#### Server
- `API_PORT` (default: "8080")
- `API_READ_TIMEOUT` (default: "10s")
- `API_WRITE_TIMEOUT` (default: "10s")
- `API_IDLE_TIMEOUT` (default: "120s")
- `API_BODY_LIMIT` (default: "10485760" - 10MB)

#### Database
- `POSTGRES_HOST` (default: "localhost")
- `POSTGRES_PORT` (default: "5432")
- `POSTGRES_USER` (default: "postgres")
- `POSTGRES_PASSWORD` (default: "postgres")
- `POSTGRES_DB` (default: "gestao_financeira")
- `POSTGRES_SSLMODE` (default: "disable")
- `POSTGRES_MAX_OPEN_CONNS` (default: 25)
- `POSTGRES_MAX_IDLE_CONNS` (default: 5)
- `POSTGRES_CONN_MAX_LIFETIME` (default: "5m")

#### JWT
- `JWT_SECRET` (default: "your-secret-key-change-in-production")
- `JWT_EXPIRATION` (default: "24h")
- `JWT_ISSUER` (default: "gestao-financeira-api")
- `JWT_SIGNING_METHOD` (default: "HS256")

#### Redis
- `REDIS_URL` (default: "")
- `REDIS_TTL` (default: "5m")

#### Logging
- `LOG_LEVEL` (default: "info")
- `LOG_FORMAT` (default: "console")

#### Migrations
- `MIGRATIONS_PATH` (default: "file://migrations")

#### CORS
- `ALLOWED_ORIGINS` (default: "http://localhost:3000")
- `CORS_MAX_AGE` (default: 86400)

### Validações Implementadas

- ✅ Ambiente válido (dev, development, staging, production, prod)
- ✅ Database host, user e name obrigatórios
- ✅ Database password obrigatório em produção
- ✅ JWT secret obrigatório em produção (não pode ser default)
- ✅ Log level válido (debug, info, warn, error, fatal, panic, trace)
- ✅ Log format válido (json, console)

### Testes

#### config_test.go
- ✅ Carregar configuração com defaults
- ✅ Carregar configuração com variáveis de ambiente
- ✅ Validar ambiente inválido
- ✅ Validar configuração válida
- ✅ Validar host de database faltando
- ✅ Validar user de database faltando
- ✅ Validar nome de database faltando
- ✅ Validar log level inválido
- ✅ Validar log format inválido
- ✅ Testar IsProduction()
- ✅ Testar IsDevelopment()
- ✅ Testar parseDuration()
- ✅ Testar parseInt()

### Uso

```go
// Carregar configuração
cfg, err := config.Load()
if err != nil {
    log.Fatal().Err(err).Msg("Failed to load configuration")
}

// Usar configuração
db := database.NewDatabaseWithConfig(cfg.Database)
jwtService := jwt.NewJWTServiceWithConfig(cfg.JWT)
logger.InitLoggerWithConfig(cfg.Logging)
```

### Commits Realizados

- `feat(backend): CONFIG-001 - configuração centralizada`
- `test(backend): adicionar testes para configuração centralizada`
- `docs(backend): adicionar documentação completa de configuração`

### Próxima Tarefa

Observabilidade Avançada (métricas, tracing, dashboards)
